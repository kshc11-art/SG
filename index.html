<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ì½ê¸° ê°€ì´ë“œ">
  <title>ì½ê¸° ê°€ì´ë“œ v5</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f8fafc; min-height: 100vh; }
    body { padding-bottom: env(safe-area-inset-bottom); }
    button { font-family: inherit; cursor: pointer; border: none; background: none; }
    button:active { opacity: 0.8; }
    .container { max-width: 500px; margin: 0 auto; padding-bottom: 80px; }
    .tab-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e2e8f0; z-index: 100; padding-bottom: env(safe-area-inset-bottom); }
    .tab-bar-inner { display: flex; max-width: 500px; margin: 0 auto; }
    .tab-btn { flex: 1; padding: 0.75rem 0.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; }
    .tab-btn span:first-child { font-size: 1.25rem; }
    .tab-btn span:last-child { font-size: 0.75rem; }
    .tab-btn.active span:last-child { color: #2563eb; font-weight: 600; }
    .tab-btn:not(.active) span:last-child { color: #94a3b8; }
    .page { padding: 1rem; }
    .stats-bar { display: flex; justify-content: center; gap: 2rem; padding: 1rem; background: #fef3c7; border-radius: 16px; margin-bottom: 1.5rem; }
    .stat { text-align: center; }
    .stat-icon { font-size: 1.5rem; }
    .stat-text { font-size: 0.8rem; color: #92400e; }
    h2 { font-size: 1.5rem; font-weight: 700; text-align: center; margin-bottom: 1.5rem; color: #1e293b; }
    .type-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .type-btn { padding: 1.5rem 1rem; border-radius: 20px; display: flex; flex-direction: column; align-items: center; gap: 0.75rem; }
    .type-icon { width: 56px; height: 56px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 2rem; }
    .type-name { font-size: 1.1rem; font-weight: 600; color: #1e293b; }
    .header-bar { display: flex; justify-content: space-between; margin-bottom: 1rem; }
    .header-btn { padding: 0.5rem 1rem; border-radius: 10px; font-size: 0.9rem; }
    .progress-bar { margin-bottom: 1rem; }
    .progress-label { display: flex; justify-content: space-between; font-size: 0.85rem; color: #64748b; margin-bottom: 0.5rem; }
    .progress-track { height: 6px; background: #e2e8f0; border-radius: 3px; }
    .progress-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }
    .phase-bar { display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; border-radius: 12px; margin-bottom: 1rem; }
    .phase-emoji { font-size: 1.25rem; }
    .phase-name { font-weight: 700; }
    .phase-duration { font-size: 0.8rem; color: #64748b; }
    .step-type-badge { margin-left: auto; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.7rem; }
    .card { background: white; border-radius: 24px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 1rem; }
    .card-label { font-size: 0.75rem; font-weight: 600; margin-bottom: 0.5rem; }
    .card-title { font-size: 1.4rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem; }
    .thought-box { border-radius: 16px; padding: 1rem; margin-bottom: 1rem; }
    .thought-label { font-size: 0.75rem; color: #64748b; }
    .thought-text { font-size: 1.1rem; font-weight: 500; font-style: italic; }
    .overview-box { font-size: 0.95rem; color: #475569; padding: 0.75rem; background: #f8fafc; border-radius: 12px; margin-bottom: 1rem; }
    .toggle-btn { width: 100%; padding: 0.75rem; border-radius: 12px; font-size: 1rem; font-weight: 600; margin-bottom: 1rem; }
    .details-box { padding: 1rem; background: #f8fafc; border-radius: 16px; }
    .detail-item { padding: 0.5rem 0.75rem; background: white; border-radius: 8px; margin-bottom: 0.5rem; font-size: 0.85rem; }
    .detail-item.bordered { border-left: 3px solid; }
    .checkpoint { padding: 0.75rem 1rem; background: #fef3c7; border-radius: 12px; font-size: 0.9rem; color: #92400e; margin-top: 1rem; }
    .complete-btn { width: 100%; padding: 1.25rem; border-radius: 16px; color: white; font-size: 1.1rem; font-weight: 600; margin-top: 1rem; }
    .nav-buttons { display: flex; gap: 0.75rem; margin-top: 1rem; }
    .nav-btn { flex: 1; padding: 0.75rem; border-radius: 12px; font-size: 1rem; }
    .nav-btn.prev { background: white; border: 1px solid #e2e8f0; color: #64748b; }
    .nav-btn.next { color: white; font-weight: 600; }
    .minimap { margin-top: 1rem; padding: 1rem; background: #f8fafc; border-radius: 16px; }
    .minimap-label { font-size: 0.8rem; color: #64748b; margin-bottom: 0.75rem; }
    .minimap-phases { display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; }
    .minimap-phase { display: flex; align-items: center; gap: 4px; }
    .minimap-dot { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; }
    .minimap-arrow { color: #cbd5e1; }
    details { border-radius: 16px; margin-bottom: 0.75rem; overflow: hidden; }
    summary { padding: 1rem; font-weight: 600; cursor: pointer; list-style: none; }
    summary::-webkit-details-marker { display: none; }
    .details-content { padding: 0 1rem 1rem; }
    .tool-item { background: white; border-radius: 10px; padding: 0.75rem; margin-bottom: 0.5rem; }
    .tool-title { font-weight: 600; }
    .tool-sub { font-size: 0.8rem; color: #64748b; }
    .tool-hint { font-size: 0.8rem; color: #059669; }
    .timer-display { font-size: 5rem; font-weight: 700; font-family: monospace; margin-bottom: 1.5rem; }
    .timer-presets { display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1.5rem; }
    .preset-btn { padding: 0.75rem 1.25rem; border-radius: 25px; font-size: 1rem; }
    .preset-btn.active { border: 2px solid #2563eb; background: #eff6ff; color: #2563eb; }
    .preset-btn:not(.active) { border: 2px solid #e2e8f0; background: white; color: #64748b; }
    .timer-controls { display: flex; gap: 1rem; justify-content: center; }
    .timer-main-btn { padding: 1rem 3rem; border-radius: 50px; color: white; font-size: 1.1rem; font-weight: 600; }
    .timer-reset-btn { padding: 1rem 1.5rem; border-radius: 50px; border: 1px solid #e2e8f0; background: white; color: #64748b; font-size: 1.1rem; }
    .option-btn { width: 100%; text-align: left; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 10px; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem; }
    .option-btn.checked { background: #dcfce7; border-color: #86efac; }
    .option-checkbox { width: 22px; height: 22px; border-radius: 6px; border: 2px solid #cbd5e1; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem; flex-shrink: 0; }
    .option-btn.checked .option-checkbox { background: #22c55e; border-color: #22c55e; }
    .option-label { font-weight: 600; }
    .option-hint { font-size: 0.8rem; color: #64748b; }
    .overview-card { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 1rem; }
    .overview-header { padding: 1rem; display: flex; align-items: center; gap: 0.5rem; }
    .overview-steps { padding: 0.75rem; }
    .overview-step { padding: 0.75rem; border-radius: 10px; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem; cursor: pointer; }
    .overview-step-num { width: 24px; height: 24px; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 600; flex-shrink: 0; }
    .overview-step-info { flex: 1; }
    .overview-step-title { font-weight: 600; font-size: 0.95rem; }
    .overview-step-desc { font-size: 0.8rem; color: #64748b; }
  </style>
</head>
<body>
  <div class="container" id="app"></div>
  <div class="tab-bar">
    <div class="tab-bar-inner" id="tabs"></div>
  </div>
  <script>
    var TEXT_STRUCTURES = {
      simple: [
        { name: 'ë‚˜ì—´/ì„¤ëª…', icon: 'ğŸ“‹', signals: ['ì˜ˆë¥¼ ë“¤ì–´', 'íŠ¹ì§•ì€', 'í¬í•¨í•˜ì—¬'], question: 'ì´ê²ƒì˜ íŠ¹ì§•ì€?' },
        { name: 'ìˆœì„œ/ê³¼ì •', icon: '1ï¸âƒ£', signals: ['ì²«ì§¸', 'ë‹¤ìŒìœ¼ë¡œ', 'ë§ˆì§€ë§‰ìœ¼ë¡œ'], question: 'ì–´ë–¤ ìˆœì„œë¡œ?' },
        { name: 'ì‹œê°„ìˆœ', icon: 'ğŸ“…', signals: ['ì²˜ìŒì—', 'ë‚˜ì¤‘ì—', 'ê·¸ë•Œ'], question: 'ì–¸ì œ ë¬´ìŠ¨ ì¼ì´?' },
        { name: 'ì •ì˜', icon: 'ğŸ“–', signals: ['~ë€', '~ì€/ëŠ”', 'ì •ì˜í•˜ë©´'], question: 'ì´ê²ƒì€ ë¬´ì—‡?' },
        { name: 'ë¹„êµ/ëŒ€ì¡°', icon: 'âš–ï¸', signals: ['ê·¸ëŸ¬ë‚˜', 'ë°˜ë©´', '~ì™€ ë‹¬ë¦¬'], question: 'ì–´ë–»ê²Œ ë‹¤ë¥¸ê°€?' }
      ],
      complex: [
        { name: 'ì›ì¸/ê²°ê³¼', icon: 'ğŸ”—', signals: ['ë•Œë¬¸ì—', 'ë”°ë¼ì„œ', '~ë¡œ ì¸í•´'], question: 'ì™œ? ê²°ê³¼ëŠ”?' },
        { name: 'ë¬¸ì œ/í•´ê²°', icon: 'ğŸ’¡', signals: ['ë¬¸ì œëŠ”', 'í•´ê²°ì±…ì€', 'ë°©ë²•ì€'], question: 'ë¬¸ì œì™€ í•´ê²°ì±…?' },
        { name: 'ì£¼ì¥/ê·¼ê±°', icon: 'âš”ï¸', signals: ['ì£¼ì¥í•˜ê±´ëŒ€', 'ì—°êµ¬ì— ë”°ë¥´ë©´'], question: 'ì£¼ì¥ê³¼ ê·¼ê±°?' },
        { name: 'í‰ê°€/ë¹„í‰', icon: 'â­', signals: ['í‰ê°€í•˜ë©´', 'ì¥ë‹¨ì ì€'], question: 'ì–´ë–¤ ê¸°ì¤€?' },
        { name: 'ê·€ë‚©/ì—°ì—­', icon: 'ğŸ”º', signals: ['ì¼ë°˜ì ìœ¼ë¡œ', 'êµ¬ì²´ì ìœ¼ë¡œ'], question: 'ë…¼ë¦¬ íë¦„?' }
      ]
    };
    var SIGNAL_WORDS = [
      { category: 'ì¶”ê°€/ê°•ì¡°', words: ['ë˜í•œ', 'ê²Œë‹¤ê°€', 'íŠ¹íˆ'], meaning: '"íŠ¹íˆ"=â­ì¤‘ìš”', color: '#22c55e' },
      { category: 'ëŒ€ì¡°/ì „í™˜', words: ['ê·¸ëŸ¬ë‚˜', 'í•˜ì§€ë§Œ', 'ë°˜ë©´'], meaning: 'âš ï¸ í•µì‹¬ì¼ í™•ë¥  ë†’ìŒ', color: '#ef4444' },
      { category: 'ì¸ê³¼', words: ['ë”°ë¼ì„œ', 'ê·¸ëŸ¬ë¯€ë¡œ', 'ë•Œë¬¸ì—'], meaning: 'ë…¼ë¦¬ íë¦„ í•µì‹¬', color: '#3b82f6' },
      { category: 'ì˜ˆì‹œ', words: ['ì˜ˆë¥¼ ë“¤ì–´', 'ê°€ë ¹', 'ì¦‰'], meaning: 'ì´í•´í–ˆìœ¼ë©´ ìŠ¤í‚µ ê°€ëŠ¥', color: '#8b5cf6' },
      { category: 'ê²°ë¡ ', words: ['ê²°ë¡ ì ìœ¼ë¡œ', 'ìš”ì•½í•˜ë©´', 'ê²°êµ­'], meaning: 'âœ… ë°˜ë“œì‹œ ì§‘ì¤‘', color: '#10b981' }
    ];
    var FICTION_SIGNPOSTS = [
      { name: 'ëŒ€ì¡°/ëª¨ìˆœ', trigger: 'ì˜ˆìƒê³¼ ë‹¤ë¥¸ í–‰ë™', question: 'ì™œ?' },
      { name: 'ê¹¨ë‹¬ìŒ', trigger: '"ì•Œì•˜ë‹¤"', question: 'ë­˜ ë°”ê¿€ê¹Œ?' },
      { name: 'ì–´ë ¤ìš´ ì§ˆë¬¸', trigger: 'í˜ë“  ìë¬¸', question: 'ë¬´ìŠ¨ ê°ˆë“±?' },
      { name: 'ì¡°ì–¸ì', trigger: 'ê²½í—˜ì ì¡°ì–¸', question: 'êµí›ˆ?' },
      { name: 'ë°˜ë³µ', trigger: 'ê°™ì€ ê²ƒ ë°˜ë³µ', question: 'ì™œ?' },
      { name: 'íšŒìƒ', trigger: 'ê³¼ê±° ì¥ë©´', question: 'ì™œ ì§€ê¸ˆ?' }
    ];
    var NONFICTION_GENRES = [
      { icon: 'ğŸ’ª', name: 'ìê¸°ê³„ë°œ', focus: 'ì•¡ì…˜ë§Œ', insight: '90% filler' },
      { icon: 'ğŸ§¬', name: 'ê³¼í•™êµì–‘', focus: 'ì£¼ì¥vsì¦ê±°', insight: 'ë¹„íŒì ìœ¼ë¡œ' },
      { icon: 'ğŸ’¼', name: 'ë¹„ì¦ˆë‹ˆìŠ¤', focus: 'í”„ë ˆì„ì›Œí¬', insight: 'í•˜ë‚˜ë§Œ' },
      { icon: 'âœï¸', name: 'ì—ì„¸ì´', focus: 'ê´€ì /ë…¼ë¦¬', insight: 'ë‚´ ìƒê° ë¹„êµ' }
    ];
    var EXPERT_STRATEGIES = [
      { icon: 'ğŸ”“', name: 'í™œì„±í™”', what: 'ì‚¬ì „ì§€ì‹ ë– ì˜¬ë¦¬ê¸°', how: '"ì•„ëŠ” ê±´?" 30ì´ˆ' },
      { icon: 'ğŸ”®', name: 'ì¶”ë¡ ', what: 'ê¸€ì— ì—†ëŠ” ê²ƒ ì±„ìš°ê¸°', how: '"ì´ê±´ ~ê² ì§€"' },
      { icon: 'ğŸ”', name: 'ì ê²€', what: 'ì´í•´ ì—¬ë¶€ í™•ì¸', how: '"ì´í•´í•˜ë‚˜?" ë§¤ ë¬¸ë‹¨' },
      { icon: 'â“', name: 'ì§ˆë¬¸', what: 'ê¸€ì— ì§ˆë¬¸', how: '"ì™œ?" "ì–´ë–»ê²Œ?"' },
      { icon: 'ğŸ“', name: 'ìš”ì•½', what: 'ë‚´ ë§ë¡œ í‘œí˜„', how: '"í•µì‹¬ì€..." í•œ ë¬¸ì¥' },
      { icon: 'ğŸ¨', name: 'ì‹œê°í™”', what: 'ë¨¸ë¦¿ì† ê·¸ë¦¼', how: 'ë‹¤ì´ì–´ê·¸ë¨ ìƒìƒ' },
      { icon: 'ğŸ”—', name: 'ì—°ê²°', what: 'ë‹¤ë¥¸ ê²ƒê³¼ ì—°ê²°', how: '"~ì™€ ë¹„ìŠ·í•˜ë„¤"' }
    ];
    var EMERGENCY = [
      { emoji: 'ğŸ˜µ', situation: 'ì´í•´ ì•ˆ ë¼', strategies: [{ action: 'ë¬¸ì¥ ìª¼ê°œê¸°', how: 'ê¸´ ë¬¸ì¥ ëŠê¸°', example: '"AëŠ” Bë‹¤" ë¨¼ì €' }, { action: 'ì²« ë¬¸ì¥ë§Œ', how: 'ê° ë¬¸ë‹¨ ì²« ë¬¸ì¥', example: 'ì—°ê²°í•´ì„œ ì½ê¸°' }, { action: 'ê²°ë¡ ë¶€í„°', how: 'ë§ˆì§€ë§‰ ë¨¼ì €', example: 'ê²°ë¡ â†’ë³¸ë¡ â†’ì„œë¡ ' }, { action: 'ì‰¬ìš´ ìë£Œ', how: 'ìœ„í‚¤, ìœ íŠœë¸Œ', example: '10ë¶„ ì˜ìƒ í›„' }] },
      { emoji: 'ğŸ¤”', situation: 'ê¸°ì–µ ì•ˆ ë‚˜', strategies: [{ action: 'ë®ê³  ë§í•˜ê¸°', how: 'ì†Œë¦¬ë‚´ì–´', example: '10ì´ˆ ì•ˆì— í•µì‹¬' }, { action: 'í‚¤ì›Œë“œ 3ê°œ', how: 'ì¤‘ìš”í•œ ê²ƒë§Œ', example: '[ìˆ˜ë©´][ê¸°ì–µ][í†µí•©]' }, { action: 'ê·¸ë¦¼ìœ¼ë¡œ', how: 'ë‹¤ì´ì–´ê·¸ë¨', example: 'ì›ì¸â†’ê²°ê³¼' }, { action: 'ì„¤ëª…í•´ë³´ê¸°', how: 'ëˆ„êµ°ê°€ì—ê²Œ', example: '"ì´ê±´ ë§ì´ì•¼..."' }] },
      { emoji: 'ğŸ¤¯', situation: 'ì§‘ì¤‘ ì•ˆ ë¼', strategies: [{ action: '5ë¶„ë§Œ', how: 'íƒ€ì´ë¨¸ 5ë¶„', example: 'ê·¸ í›„ ê²°ì •' }, { action: 'ì†Œë¦¬ë‚´ì–´', how: 'ì…ìœ¼ë¡œ ì½ê¸°', example: 'ì¤‘ì–¼ì¤‘ì–¼' }, { action: 'ì†ê°€ë½', how: 'ì¤„ ì¶”ì ', example: 'ëˆˆ ê³ ì •' }, { action: 'í™˜ê²½ ë¦¬ì…‹', how: 'í° ì¹˜ìš°ê¸°', example: '2ë¶„ í™˜ê¸°' }] },
      { emoji: 'ğŸŒ²', situation: 'ì „ì²´ê°€ ì•ˆ ë³´ì—¬', strategies: [{ action: 'ëª©ì°¨ë¡œ', how: 'í˜„ì¬ ìœ„ì¹˜', example: '"3ì¥ ì¤‘ 2ë²ˆì§¸"' }, { action: 'í•œ ì¤„ ì •ë¦¬', how: '"ì—¬ê¸°ê¹Œì§€ëŠ”..."', example: '"ë¬¸ì œâ†’ì›ì¸â†’í•´ê²°"' }, { action: 'ì§€ë„ ê·¸ë¦¬ê¸°', how: 'ë°•ìŠ¤+í™”ì‚´í‘œ', example: '[ì„œë¡ ]â†’[ë³¸ë¡ ]' }] },
      { emoji: 'ğŸ˜°', situation: 'ë„ˆë¬´ ì–´ë ¤ì›Œ', strategies: [{ action: 'ë‚œì´ë„ ë‚®ì¶”ê¸°', how: 'ì‰¬ìš´ ìë£Œ', example: 'ì…ë¬¸ì„œ' }, { action: 'ê±´ë„ˆë›°ê¸°', how: 'í‘œì‹œ+ë„˜ê¸°ê¸°', example: 'â­ â†’ ë‚˜ì¤‘ì—' }, { action: 'ëª©í‘œ ì¶•ì†Œ', how: 'ì˜¤ëŠ˜ 1í˜ì´ì§€', example: 'ì‘ì€ ì„±ê³µ' }] }
    ];
    var PROTOCOLS = {
      academic: { name: 'í•™ìˆ ì„œ/ë…¼ë¬¸', icon: 'ğŸ“', color: '#1d4ed8', bg: '#dbeafe', light: '#bfdbfe', phases: [
        { name: 'í° ê·¸ë¦¼', duration: '3ë¶„', emoji: 'ğŸ—ºï¸', steps: [
          { title: '30ì´ˆ ìŠ¤ìº”', type: 'seq', thought: '"ì „ì²´ ì§€í˜•ì€?"', overview: 'ì œëª©â†’ì†Œì œëª©â†’ì²«/ë ë¬¸ë‹¨', details: ['â‘  ì œëª©', 'â‘¡ ì†Œì œëª©ë“¤', 'â‘¢ ì²«+ë ë¬¸ë‹¨', 'â‘£ ê·¸ë¦¼/í‘œ'], checkpoint: 'í° ê·¸ë¦¼ ê·¸ë ¤ì ¸?' },
          { title: 'êµ¬ì¡° íŒë³„', type: 'opt', thought: '"ì–´ë–¤ íŒ¨í„´?"', overview: 'êµ¬ì¡° ì°¾ê¸°', options: ['ì£¼ì¥-ê·¼ê±°', 'ë¬¸ì œ-í•´ê²°', 'ì›ì¸-ê²°ê³¼', 'ë¹„êµ-ëŒ€ì¡°', 'ìˆœì„œ'], checkpoint: 'êµ¬ì¡° ì •í–ˆì–´?' },
          { title: 'ëª©ì  ì„¤ì •', type: 'seq', thought: '"ë­˜ ì–»ì„ê¹Œ?"', overview: 'ëª©í‘œ í•œ ë¬¸ì¥', template: '"ì½ê³  ë‚˜ë©´ [____] ì•Œê²Œ ë  ê²ƒ"', checkpoint: 'ëª©ì  ì™„ì„±?' }
        ]},
        { name: 'ì •ë…', duration: 'ë¬¸ë‹¨ë‹¹ 2-3ë¶„', emoji: 'ğŸ“–', steps: [
          { title: 'ë¬¸ë‹¨ ì½ê¸°', type: 'seq', thought: '"ì—­í• ì€?"', overview: 'ê¸°ëŠ¥ íŒŒì•…', details: ['ğŸ¯ ì£¼ì œ ì œì‹œ', 'ğŸ“Š ê·¼ê±°/ì˜ˆì‹œ', 'âš¡ ë°˜ë¡ ', 'â¡ï¸ ì „í™˜', 'ğŸ“‹ ìš”ì•½'], tip: 'ì²« ë¬¸ì¥ì— 80%', checkpoint: 'ì—­í•  íŒŒì•…?' },
          { title: 'ë®ê³  ë§í•˜ê¸°', type: 'seq', thought: '"ë°©ê¸ˆ ê±´..."', overview: 'ì¸ì¶œ ì—°ìŠµ', details: ['â‘  ê°€ë¦¬ê¸°', 'â‘¡ "í•µì‹¬ì€..." ë§í•˜ê¸°', 'â‘¢ í™•ì¸'], science: 'ì¬ì½ê¸°ë³´ë‹¤ 50% íš¨ê³¼', checkpoint: 'ë§í•  ìˆ˜ ìˆì–´?' },
          { title: 'ì‹ í˜¸ì–´ ë°˜ì‘', type: 'opt', thought: '"ë­˜ ì•Œë ¤ì£¼ì§€?"', overview: 'ì‹ í˜¸ì–´ ë°˜ì‘', signals: [{ word: 'ê·¸ëŸ¬ë‚˜', action: 'âš ï¸ ì§‘ì¤‘!', color: '#ef4444' }, { word: 'ë”°ë¼ì„œ', action: 'ê²°ë¡ !', color: '#3b82f6' }, { word: 'íŠ¹íˆ', action: 'â­ ê°•ì¡°', color: '#f59e0b' }], checkpoint: 'ì‹ í˜¸ì–´ ë°˜ì‘?' },
          { title: 'í‚¤ì›Œë“œ ë©”ëª¨', type: 'opt', thought: '"ì´ê±¸ë¡œ ê¸°ì–µ"', overview: '1-2ê°œë§Œ', format: '[ì„¹ì…˜] - í‚¤ì›Œë“œ', checkpoint: 'í‚¤ì›Œë“œ ì ì—ˆì–´?' }
        ]},
        { name: 'ë§ˆë¬´ë¦¬', duration: '3ë¶„', emoji: 'âœ…', steps: [
          { title: '3ë¬¸ì¥ ìš”ì•½', type: 'seq', thought: '"í•µì‹¬ë§Œ..."', overview: '3ë¬¸ì¥ ì••ì¶•', structure: ['1ï¸âƒ£ ì£¼ì œ', '2ï¸âƒ£ í•µì‹¬', '3ï¸âƒ£ ì´ìœ '], checkpoint: '3ë¬¸ì¥ ì™„ì„±?' },
          { title: 'ë‚´ ë°˜ì‘', type: 'opt', thought: '"ë‚˜ëŠ”..."', overview: 'ë°˜ì‘ í•œ ì¤„', options: ['ë™ì˜', 'ì˜ë¬¸', 'ì ìš©', 'ì—°ê²°'], checkpoint: 'ë°˜ì‘ ì ì—ˆì–´?' },
          { title: 'ë³µìŠµ ì¼ì •', type: 'seq', thought: '"ì–¸ì œ ë‹¤ì‹œ?"', overview: 'ê°„ê²© ë°˜ë³µ', schedule: ['ë‚´ì¼', '3ì¼ í›„', '1ì£¼ í›„'], checkpoint: 'ì¼ì • ì •í–ˆì–´?' }
        ]}
      ]},
      fiction: { name: 'ì†Œì„¤/ë¬¸í•™', icon: 'ğŸ“š', color: '#be185d', bg: '#fce7f3', light: '#fbcfe8', phases: [
        { name: 'ì¤€ë¹„', duration: '1ë¶„', emoji: 'ğŸ“š', steps: [
          { title: 'í‘œì§€/ì œëª© ë¶„ì„', type: 'seq', thought: '"ë­˜ ë‹¤ë£°ê¹Œ?"', overview: 'íŒíŠ¸ ì–»ê¸°', details: ['í‘œì§€â†’ë¶„ìœ„ê¸°', 'ì œëª©â†’ì£¼ì œ', 'ì†Œê°œâ†’ê°ˆë“±'], checkpoint: 'ì˜ˆì¸¡í•´ë´¤ì–´?' },
          { title: 'ì¶”ì  ì¤€ë¹„', type: 'opt', thought: '"ê¸°ë¡í•˜ë©´ì„œ"', overview: 'ë©”ëª¨ ë°©ì‹', marks: ['?=ì§ˆë¬¸', '!=ì¤‘ìš”', 'â˜…=ëª…ë¬¸ì¥', 'C=ë³€í™”', 'F=ë³µì„ '], checkpoint: 'ë°©ì‹ ì •í–ˆì–´?' }
        ]},
        { name: 'ëª°ì…', duration: 'ììœ ', emoji: 'ğŸŒ™', steps: [
          { title: 'ì¥ë©´ ì‹œê°í™”', type: 'opt', thought: '"ì˜í™”ì²˜ëŸ¼"', overview: 'ë¨¸ë¦¿ì† ì¬í˜„', elements: ['ê³µê°„', 'ì¸ë¬¼', 'ë¶„ìœ„ê¸°'], checkpoint: 'ê·¸ë ¤ì ¸?' },
          { title: 'ì¸ë¬¼ ì¶”ì ', type: 'opt', thought: '"ë­˜ ì•Œê²Œ ëì§€?"', overview: 'ê¸°ë¡', track: ['ì´ë¦„/ì™¸ëª¨', 'ê´€ê³„', 'ë™ê¸°', 'ê°ˆë“±', 'ë³€í™”'], checkpoint: 'íŒŒì•…í•˜ê³  ìˆì–´?' },
          { title: 'ë¬¸í•™ ì‹ í˜¸ë“±', type: 'opt', thought: '"ì¤‘ìš”í•œ ìˆœê°„?"', overview: '6ê°€ì§€ ì‹ í˜¸', useSignposts: true, checkpoint: 'í¬ì°©í•´?' },
          { title: 'ì£¼ì œ íŒíŠ¸', type: 'opt', thought: '"ë­˜ ë§í•˜ë ¤ëŠ” ê±¸ê¹Œ?"', overview: 'íŒíŠ¸ ìˆ˜ì§‘', hints: ['ë°˜ë³µ', 'ê°ˆë“±', 'ë³€í™”', 'ì œëª©'], checkpoint: 'ëª¨ìœ¼ê³  ìˆì–´?' }
        ]},
        { name: 'ë©ˆì¶œ ë•Œ', duration: '30ì´ˆ', emoji: 'ğŸ”–', steps: [
          { title: 'ìƒí™© ë©”ëª¨', type: 'seq', thought: '"ì´ì–´ê°€ë ¤ë©´"', overview: 'í•œ ì¤„ë¡œ', format: '[ì¥ì†Œ]-[ëˆ„ê°€]-[ë­ í•˜ëŠ” ì¤‘]', checkpoint: 'ë©”ëª¨í–ˆì–´?' }
        ]},
        { name: 'ë‹¤ ì½ì€ í›„', duration: '5-10ë¶„', emoji: 'ğŸ†', steps: [
          { title: 'í”Œë¡¯ ì •ë¦¬', type: 'seq', thought: '"íë¦„ì€..."', overview: '6ë‹¨ê³„', stages: ['ë°œë‹¨', 'ì‚¬ê±´ë°œìƒ', 'ìƒìŠ¹', 'ì ˆì •', 'í•˜ê°•', 'ê²°ë§'], checkpoint: 'ì •ë¦¬í–ˆì–´?' },
          { title: 'ì¸ë¬¼ ë³€í™”', type: 'seq', thought: '"ì–´ë–»ê²Œ ë³€í–ˆì§€?"', overview: 'ë³€í™” ì•„í¬', template: '[ì¸ë¬¼]ì€ [A]â†’[B]ë¡œ ë³€í–ˆë‹¤', checkpoint: 'ë³€í™” ì •ë¦¬?' },
          { title: 'ì£¼ì œ ê²°ë¡ ', type: 'seq', thought: '"ë§í•˜ë ¤ëŠ” ê±´..."', overview: 'ì£¼ì œ ë„ì¶œ', template: '"ì´ ì‘í’ˆì€ [____]ì— ëŒ€í•´ [____]ì„ ë§í•œë‹¤"', checkpoint: 'ì£¼ì œ í•œ ë¬¸ì¥?' }
        ]}
      ]},
      nonfiction: { name: 'ëŒ€ì¤‘ ë¹„ë¬¸í•™', icon: 'ğŸ’¡', color: '#059669', bg: '#ecfdf5', light: '#a7f3d0', phases: [
        { name: 'ì¥ë¥´ íŒŒì•…', duration: '1ë¶„', emoji: 'ğŸ”', steps: [
          { title: 'ìœ í˜• íŒë³„', type: 'opt', thought: '"ì–´ë–¤ ì¢…ë¥˜?"', overview: 'ì¥ë¥´ë§ˆë‹¤ ë‹¤ë¦„', useGenres: true, checkpoint: 'ìœ í˜• ì •í–ˆì–´?' },
          { title: 'ë‚´ ëª©ì ', type: 'seq', thought: '"ë­˜ ì–»ì§€?"', overview: 'êµ¬ì²´ì  ëª©ì ', tip: 'ëª©ì  ì—†ìœ¼ë©´ ë‹¤ ê¹Œë¨¹ìŒ', checkpoint: 'ëª©ì  ì •í–ˆì–´?' },
          { title: 'ëª©ì°¨ ì„ ë³„', type: 'seq', thought: '"ì–´ë””ê°€ ìœ ìš©?"', overview: 'ê´€ë ¨ ì±•í„°', details: ['â‘  ëª©ì°¨ í›‘ê¸°', 'â‘¡ 2-3ê°œ í‘œì‹œ', 'â‘¢ ê·¸ê²ƒë¶€í„°'], checkpoint: 'ì±•í„° ê³¨ëì–´?' }
        ]},
        { name: 'ì „ëµì  ì½ê¸°', duration: 'ììœ ', emoji: 'ğŸ“š', steps: [
          { title: 'ì¥ë¥´ë³„ ì „ëµ', type: 'opt', thought: '"ì´ ìœ í˜•ì€..."', overview: 'ìœ í˜•ì— ë§ê²Œ', useStrategies: true, checkpoint: 'ì¥ë¥´ì— ë§ê²Œ?' },
          { title: 'ìµœì†Œ í‘œì‹œ', type: 'seq', thought: '"ë‹¤ ì¤‘ìš”í•˜ë©´ ë‹¤ X"', overview: '5-10ê°œë§Œ', tip: 'ì´ê²ƒë§Œ ë³´ê³  ë³µìŠµ', checkpoint: 'ì„ ë³„ì ?' },
          { title: 'ì ìš© ìƒê°', type: 'opt', thought: '"ë‚´ ìƒí™©ì—..."', overview: 'ì ìš© ê°€ëŠ¥ì„±', questions: ['ê°€ëŠ¥?', 'ë­˜ í•´ì•¼?', 'ì¥ì• ë¬¼?', 'ë‚´ì¼ ë‹¹ì¥?'], checkpoint: 'ì ìš© ìƒê°?' }
        ]},
        { name: 'ë§ˆë¬´ë¦¬', duration: '3ë¶„', emoji: 'âœ¨', steps: [
          { title: 'í•µì‹¬ ì¶”ì¶œ', type: 'opt', thought: '"ê±´ì§„ ê±´..."', overview: 'ì¥ë¥´ë³„ ì •ë¦¬', outputs: ['ìê¸°ê³„ë°œâ†’ì•¡ì…˜ 1-2ê°œ', 'ê³¼í•™â†’ì£¼ì¥+ì¦ê±°', 'ë¹„ì¦ˆë‹ˆìŠ¤â†’í”„ë ˆì„ì›Œí¬', 'ì—ì„¸ì´â†’ì£¼ì¥+ë‚´ ì…ì¥'], checkpoint: 'ì •ë¦¬í–ˆì–´?' },
          { title: 'ë¹„íŒì  í‰ê°€', type: 'opt', thought: '"í•œê³„ëŠ”..."', overview: 'ë§¹ëª© ìˆ˜ìš© ë°©ì§€', questions: ['ë¹ˆí‹ˆ?', 'ë°˜ëŒ€?', 'ì•ˆ í†µí•  ë•Œ?'], checkpoint: 'ë¹„íŒì ìœ¼ë¡œ?' },
          { title: 'ì‹¤í–‰ ê³„íš', type: 'seq', thought: '"ì–¸ì œ, ë­˜..."', overview: 'ë‚ ì§œ ìˆëŠ” ê³„íš', template: '"[ë‚ ì§œ]ê¹Œì§€ [í–‰ë™]"', warning: 'ë‚ ì§œ ì—†ìŒ = ì•ˆ í•¨', checkpoint: 'ì‹¤í–‰ ê³„íš?' }
        ]}
      ]},
      exam: { name: 'ì‹œí—˜ê³µë¶€', icon: 'ğŸ¯', color: '#dc2626', bg: '#fef2f2', light: '#fecaca', phases: [
        { name: 'ë¬¸ì œ ë¨¼ì €', duration: '5ë¶„', emoji: 'ğŸ¯', steps: [
          { title: 'ë¬¸ì œ í›‘ê¸°', type: 'seq', thought: '"ë­˜ ë¬¼ì–´ë³´ì§€?"', overview: 'í’€ì§€ ë§ê³  ë¶„ì„', details: ['â‘  ë¬¸ì œë§Œ ì½ê¸°', 'â‘¡ ìœ í˜• íŒŒì•…', 'â‘¢ ëª¨ë¥´ëŠ” ê²ƒ â­', 'â‘£ í‚¤ì›Œë“œ â—‹'], checkpoint: 'ìœ í˜• íŒŒì•…?' },
          { title: 'ì¶”ì¸¡í•˜ê¸°', type: 'seq', thought: '"í‹€ë ¤ë„ ë¼"', overview: 'ìƒì„± íš¨ê³¼', details: ['â‘  â­ ì„ íƒ', 'â‘¡ 30ì´ˆ ì¶”ì¸¡', 'â‘¢ í™•ì‹ ë„ %'], science: 'í‹€ë ¤ë„ í•™ìŠµì— ë„ì›€', checkpoint: 'ì¶”ì¸¡ ì ì—ˆì–´?' }
        ]},
        { name: 'ì—­ë°©í–¥ í•™ìŠµ', duration: '25ë¶„', emoji: 'ğŸ“š', steps: [
          { title: 'ê´€ë ¨ ë¶€ë¶„ ì°¾ê¸°', type: 'seq', thought: '"ë­˜ ì•Œì•„ì•¼?"', overview: 'ë¬¸ì œâ†’êµì¬', details: ['â‘  í‚¤ì›Œë“œ íŒŒì•…', 'â‘¡ ëª©ì°¨ì—ì„œ ì°¾ê¸°', 'â‘¢ ê·¸ ë¶€ë¶„ë§Œ'], checkpoint: 'ì°¾ì•˜ì–´?' },
          { title: 'ì½ê³  ë®ê³  ë§í•˜ê¸°', type: 'seq', thought: '"í•µì‹¬ì€..."', overview: 'ì¸ì¶œ ì—°ìŠµ', details: ['â‘  ì½ê¸°', 'â‘¡ ë®ê¸°', 'â‘¢ ë§í•˜ê¸°', 'â‘£ í™•ì¸'], checkpoint: 'ì¸ì¶œ ì—°ìŠµ?' },
          { title: 'ë‹¤ì‹œ í’€ê¸°', type: 'seq', thought: '"ì´ì œ í’€ ìˆ˜ ìˆì–´?"', overview: 'í•™ìŠµ í™•ì¸', details: ['â‘  ë‹¤ì‹œ í’€ê¸°', 'â‘¡ í™•ì¸', 'â‘¢ í‹€ë¦¬ë©´ "ì™œ?"'], tip: 'ì˜¤ë‹µ ì´ìœ  = ê°€ì¥ ì¤‘ìš”', checkpoint: 'ë‹¤ì‹œ í’€ì—ˆì–´?' },
          { title: 'í”Œë˜ì‹œì¹´ë“œ', type: 'opt', thought: '"ê¹Œë¨¹ì§€ ë§ì"', overview: 'í•µì‹¬ë§Œ', rules: ['ì§ˆë¬¸1=ë‹µ1', 'ìê¸° ë§ë¡œ', 'ê·¸ë¦¼ ì¶”ê°€'], checkpoint: 'ì¹´ë“œ ë§Œë“¤ì—ˆì–´?' }
        ]},
        { name: 'ë§ˆë¬´ë¦¬', duration: '2ë¶„', emoji: 'ğŸ', steps: [
          { title: 'ì˜¤ëŠ˜ ë³µìŠµ', type: 'seq', thought: '"ë°©ê¸ˆ ë°°ìš´ ê±°"', overview: 'ì²« ë³µìŠµ', details: ['â‘  ì¹´ë“œ ì „ë¶€', 'â‘¡ 3ì´ˆ ì•ˆì—', 'â‘¢ ëª» ë– ì˜¬ë¦° ê±° í‘œì‹œ'], checkpoint: 'ë³µìŠµ í–ˆì–´?' },
          { title: 'ë³µìŠµ ì¼ì •', type: 'seq', thought: '"ë§ê° ì´ê¸°ì"', overview: 'ê°„ê²© ë°˜ë³µ', schedule: ['ë‚´ì¼', '3ì¼ í›„', '1ì£¼ í›„'], tip: 'ìº˜ë¦°ë”ì—!', checkpoint: 'ì¼ì • ì •í–ˆì–´?' }
        ]}
      ]}
    };

    var state = { tab: 'guide', type: null, phase: 0, step: 0, completed: {}, checked: {}, view: 'detail', showDetails: true, timer: 25*60, timerRunning: false, timerPreset: 25, stats: JSON.parse(localStorage.getItem('lgStats') || '{"sessions":0,"points":0}') };
    var timerInterval = null;
    function saveStats() { localStorage.setItem('lgStats', JSON.stringify(state.stats)); }
    function formatTime(s) { return String(Math.floor(s/60)).padStart(2,'0') + ':' + String(s%60).padStart(2,'0'); }
    function render() {
      var app = document.getElementById('app');
      var tabs = document.getElementById('tabs');
      tabs.innerHTML = [{ id: 'guide', icon: 'ğŸ“–', label: 'ê°€ì´ë“œ' }, { id: 'tools', icon: 'ğŸ§°', label: 'ë„êµ¬' }, { id: 'emergency', icon: 'ğŸ†˜', label: 'ë¹„ìƒ' }, { id: 'timer', icon: 'â±ï¸', label: 'íƒ€ì´ë¨¸' }].map(function(t) { return '<button class="tab-btn '+(state.tab===t.id?'active':'')+'" onclick="setTab(\''+t.id+'\')"><span>'+t.icon+'</span><span>'+t.label+'</span></button>'; }).join('');
      if (state.tab === 'guide') {
        if (!state.type) app.innerHTML = renderTypeSelect();
        else if (state.view === 'overview') app.innerHTML = renderOverview();
        else app.innerHTML = renderDetail();
      } else if (state.tab === 'tools') app.innerHTML = renderTools();
      else if (state.tab === 'emergency') app.innerHTML = renderEmergency();
      else if (state.tab === 'timer') app.innerHTML = renderTimer();
    }
    function renderTypeSelect() {
      var html = '<div class="page"><div class="stats-bar"><div class="stat"><div class="stat-icon">ğŸ“š</div><div class="stat-text">'+state.stats.sessions+' ì„¸ì…˜</div></div><div class="stat"><div class="stat-icon">â­</div><div class="stat-text">'+state.stats.points+' ì </div></div></div><h2>ì§€ê¸ˆ ë­˜ ì½ìœ¼ë ¤ê³  í•´?</h2><div class="type-grid">';
      for (var k in PROTOCOLS) { var p = PROTOCOLS[k]; html += '<button class="type-btn" style="background:'+p.bg+'" onclick="selectType(\''+k+'\')"><div class="type-icon" style="background:'+p.color+'20">'+p.icon+'</div><span class="type-name">'+p.name+'</span></button>'; }
      return html + '</div></div>';
    }
    function renderOverview() {
      var p = PROTOCOLS[state.type];
      var html = '<div class="page"><div class="header-bar"><button class="header-btn" style="background:#f1f5f9;color:#64748b" onclick="resetGuide()">â† ì²˜ìŒ</button><button class="header-btn" style="border:2px solid '+p.color+';color:'+p.color+'" onclick="setView(\'detail\')">ğŸ‘ ì„¸ë¶€</button></div><h2 style="color:'+p.color+';text-align:left;font-size:1.3rem">'+p.icon+' '+p.name+' ì „ì²´</h2>';
      p.phases.forEach(function(ph, pi) {
        html += '<div class="overview-card"><div class="overview-header" style="background:'+p.light+'"><span class="phase-emoji">'+ph.emoji+'</span><span class="phase-name">'+ph.name+'</span><span class="phase-duration" style="margin-left:auto">'+ph.duration+'</span></div><div class="overview-steps">';
        ph.steps.forEach(function(st, si) {
          var done = state.completed[pi+'-'+si];
          html += '<div class="overview-step" style="background:'+(done?'#dcfce7':'#f8fafc')+'" onclick="goToStep('+pi+','+si+')"><div class="overview-step-num" style="background:'+(done?'#22c55e':p.color)+'">'+(done?'âœ“':(si+1))+'</div><div class="overview-step-info"><div class="overview-step-title">'+st.title+'</div><div class="overview-step-desc">'+st.overview+'</div></div><span style="padding:0.25rem 0.5rem;border-radius:6px;font-size:0.7rem;background:'+(st.type==='seq'?'#dbeafe':'#fef3c7')+';color:'+(st.type==='seq'?'#1d4ed8':'#92400e')+'">'+(st.type==='seq'?'ìˆœì„œ':'ì„ íƒ')+'</span></div>';
        });
        html += '</div></div>';
      });
      return html + '</div>';
    }
    function renderDetail() {
      var p = PROTOCOLS[state.type], ph = p.phases[state.phase], st = ph.steps[state.step];
      var total = 0, done = 0; p.phases.forEach(function(x) { total += x.steps.length; }); for (var k in state.completed) if (state.completed[k]) done++;
      var key = state.phase + '-' + state.step, isCompleted = state.completed[key];
      var detailsHTML = '';
      if (state.showDetails) {
        detailsHTML = '<div class="details-box">';
        if (st.details) st.details.forEach(function(d) { detailsHTML += '<div class="detail-item bordered" style="border-color:'+p.color+'40">'+d+'</div>'; });
        if (st.options) st.options.forEach(function(o, i) { detailsHTML += '<button class="option-btn '+(state.checked['opt'+i]?'checked':'')+'" onclick="toggleCheck(\'opt'+i+'\')"><div class="option-checkbox">'+(state.checked['opt'+i]?'âœ“':'')+'</div><div><div class="option-label" style="color:'+p.color+'">'+o+'</div></div></button>'; });
        if (st.signals) st.signals.forEach(function(s) { detailsHTML += '<div class="detail-item" style="border-left:4px solid '+s.color+'"><strong style="color:'+s.color+'">'+s.word+'</strong> â†’ '+s.action+'</div>'; });
        if (st.useSignposts) FICTION_SIGNPOSTS.forEach(function(sp, i) { detailsHTML += '<button class="option-btn '+(state.checked['sp'+i]?'checked':'')+'" onclick="toggleCheck(\'sp'+i+'\')"><div class="option-checkbox">'+(state.checked['sp'+i]?'âœ“':'')+'</div><div><div class="option-label" style="color:'+p.color+'">'+sp.name+'</div><div class="option-hint">ë°œê²¬: '+sp.trigger+' / ì§ˆë¬¸: '+sp.question+'</div></div></button>'; });
        if (st.useGenres) NONFICTION_GENRES.forEach(function(g, i) { detailsHTML += '<button class="option-btn '+(state.checked['g'+i]?'checked':'')+'" onclick="toggleCheck(\'g'+i+'\')"><div class="option-checkbox">'+(state.checked['g'+i]?'âœ“':'')+'</div><div><div class="option-label">'+g.icon+' '+g.name+'</div><div class="option-hint">'+g.focus+' - '+g.insight+'</div></div></button>'; });
        if (st.useStrategies) detailsHTML += '<div class="detail-item"><strong>ğŸ’ª ìê¸°ê³„ë°œ:</strong> "~í•˜ë¼" ì§€ì‹œë§Œ</div><div class="detail-item"><strong>ğŸ§¬ ê³¼í•™:</strong> ì£¼ì¥+ì¦ê±° í‰ê°€</div><div class="detail-item"><strong>ğŸ’¼ ë¹„ì¦ˆë‹ˆìŠ¤:</strong> í”„ë ˆì„ì›Œí¬ ë„ì‹í™”</div><div class="detail-item"><strong>âœï¸ ì—ì„¸ì´:</strong> ì£¼ì¥+ë‚´ ë°˜ì‘</div>';
        if (st.marks) { detailsHTML += '<div style="display:flex;flex-wrap:wrap;gap:0.5rem">'; st.marks.forEach(function(m) { detailsHTML += '<span style="padding:0.25rem 0.5rem;background:white;border-radius:6px;font-size:0.8rem">'+m+'</span>'; }); detailsHTML += '</div>'; }
        if (st.track) st.track.forEach(function(t) { detailsHTML += '<div class="detail-item">'+t+'</div>'; });
        if (st.hints) st.hints.forEach(function(h) { detailsHTML += '<div class="detail-item">'+h+'</div>'; });
        if (st.elements) st.elements.forEach(function(e) { detailsHTML += '<div class="detail-item">'+e+'</div>'; });
        if (st.stages) st.stages.forEach(function(s, i) { detailsHTML += '<div class="detail-item">'+(i+1)+'. '+s+'</div>'; });
        if (st.structure) st.structure.forEach(function(s) { detailsHTML += '<div class="detail-item">'+s+'</div>'; });
        if (st.schedule) st.schedule.forEach(function(s) { detailsHTML += '<div class="detail-item">'+s+'</div>'; });
        if (st.outputs) st.outputs.forEach(function(o) { detailsHTML += '<div class="detail-item">'+o+'</div>'; });
        if (st.questions) st.questions.forEach(function(q) { detailsHTML += '<div class="detail-item">â€¢ '+q+'</div>'; });
        if (st.rules) st.rules.forEach(function(r) { detailsHTML += '<div class="detail-item">â€¢ '+r+'</div>'; });
        if (st.template) detailsHTML += '<div class="detail-item" style="border:2px dashed '+p.color+';border-radius:10px">ğŸ“ '+st.template+'</div>';
        if (st.format) detailsHTML += '<div class="detail-item">ğŸ“‹ '+st.format+'</div>';
        if (st.science) detailsHTML += '<div style="font-size:0.8rem;color:#64748b;font-style:italic">ğŸ“Š '+st.science+'</div>';
        if (st.tip) detailsHTML += '<div style="font-size:0.85rem;color:#f59e0b">ğŸ’¡ '+st.tip+'</div>';
        if (st.warning) detailsHTML += '<div style="font-size:0.85rem;color:#dc2626">âš ï¸ '+st.warning+'</div>';
        detailsHTML += '</div>';
      }
      var minimapHTML = '<div class="minimap"><div class="minimap-label">ì „ì²´ ì§„í–‰</div><div class="minimap-phases">';
      p.phases.forEach(function(ph2, pi) {
        if (pi > 0) minimapHTML += '<span class="minimap-arrow">â†’</span>';
        minimapHTML += '<div class="minimap-phase"><span>'+ph2.emoji+'</span>';
        ph2.steps.forEach(function(_, si) { minimapHTML += '<div class="minimap-dot" style="background:'+(state.completed[pi+'-'+si]?'#10b981':(pi===state.phase&&si===state.step)?p.color:'#e2e8f0')+'" onclick="goToStep('+pi+','+si+')"></div>'; });
        minimapHTML += '</div>';
      });
      minimapHTML += '</div></div>';
      return '<div class="page"><div class="header-bar"><button class="header-btn" style="background:#f1f5f9;color:#64748b" onclick="resetGuide()">â† ì²˜ìŒ</button><button class="header-btn" style="border:2px solid '+p.color+';color:'+p.color+'" onclick="setView(\'overview\')">ğŸ“‹ ì „ì²´</button></div><div class="progress-bar"><div class="progress-label"><span style="color:'+p.color+';font-weight:600">'+p.icon+' '+p.name+'</span><span>'+done+'/'+total+'</span></div><div class="progress-track"><div class="progress-fill" style="width:'+(done/total*100)+'%;background:'+p.color+'"></div></div></div><div class="phase-bar" style="background:'+p.light+'"><span class="phase-emoji">'+ph.emoji+'</span><span class="phase-name">'+ph.name+'</span><span class="phase-duration">('+ph.duration+')</span><span class="step-type-badge" style="background:'+(st.type==='seq'?'#dbeafe':'#fef3c7')+';color:'+(st.type==='seq'?'#1d4ed8':'#92400e')+'">'+(st.type==='seq'?'ğŸ“ ìˆœì„œ':'â˜‘ï¸ ì„ íƒ')+'</span></div><div class="card" style="border:2px solid '+p.color+'30"><div class="card-label" style="color:'+p.color+'">ğŸ‘‰ ì§€ê¸ˆ í•  ê²ƒ</div><div class="card-title">'+st.title+'</div><div class="thought-box" style="background:'+p.bg+'"><div class="thought-label">ğŸ’­</div><div class="thought-text" style="color:'+p.color+'">'+st.thought+'</div></div><div class="overview-box">ğŸ“‹ '+st.overview+'</div><button class="toggle-btn" style="border:2px solid '+p.color+';background:'+(state.showDetails?p.color:'white')+';color:'+(state.showDetails?'white':p.color)+'" onclick="toggleDetails()">ğŸ“– ìì„¸íˆ '+(state.showDetails?'â–²':'â–¼')+'</button>'+(state.showDetails?detailsHTML:'')+(st.checkpoint?'<div class="checkpoint">âš ï¸ '+st.checkpoint+'</div>':'')+'</div><button class="complete-btn" style="background:'+(isCompleted?'#10b981':p.color)+'" onclick="completeAndNext()">'+(isCompleted?'âœ“ ì™„ë£Œ! ë‹¤ìŒ â†’':'âœ“ ì™„ë£Œí•˜ê³  ë‹¤ìŒ')+'</button><div class="nav-buttons"><button class="nav-btn prev" onclick="goPrev()" '+(state.phase===0&&state.step===0?'disabled style="color:#cbd5e1"':'')+'>â† ì´ì „</button><button class="nav-btn next" style="background:'+p.color+'" onclick="goNext()">ë‹¤ìŒ â†’</button></div>'+minimapHTML+'</div>';
    }
    function renderTools() {
      var html = '<div class="page"><h2 style="text-align:left;font-size:1.3rem">ğŸ§° ì½ê¸° ë„êµ¬</h2>';
      html += '<details style="background:#dbeafe"><summary>ğŸ“ í…ìŠ¤íŠ¸ êµ¬ì¡° 10ê°€ì§€</summary><div class="details-content"><div style="font-size:0.85rem;color:#64748b;margin-bottom:0.5rem">ë‹¨ìˆœ</div>';
      TEXT_STRUCTURES.simple.forEach(function(s) { html += '<div class="tool-item"><div class="tool-title" style="color:#1d4ed8">'+s.icon+' '+s.name+'</div><div class="tool-sub">'+s.signals.join(', ')+'</div><div class="tool-hint">'+s.question+'</div></div>'; });
      html += '<div style="font-size:0.85rem;color:#64748b;margin:1rem 0 0.5rem">ë³µì¡</div>';
      TEXT_STRUCTURES.complex.forEach(function(s) { html += '<div class="tool-item"><div class="tool-title" style="color:#7c3aed">'+s.icon+' '+s.name+'</div><div class="tool-sub">'+s.signals.join(', ')+'</div><div class="tool-hint">'+s.question+'</div></div>'; });
      html += '</div></details>';
      html += '<details style="background:#fef3c7"><summary>ğŸš¦ ì‹ í˜¸ì–´ ê°€ì´ë“œ</summary><div class="details-content">';
      SIGNAL_WORDS.forEach(function(sw) { html += '<div class="tool-item" style="border-left:4px solid '+sw.color+'"><div class="tool-title" style="color:'+sw.color+'">'+sw.category+'</div><div class="tool-sub">'+sw.words.join(', ')+'</div><div style="font-size:0.8rem">'+sw.meaning+'</div></div>'; });
      html += '</div></details>';
      html += '<details style="background:#fce7f3"><summary>ğŸ“– ì†Œì„¤ ë„êµ¬</summary><div class="details-content"><div style="font-weight:600;color:#be185d;margin-bottom:0.5rem">ğŸš¦ ë¬¸í•™ ì‹ í˜¸ë“±</div>';
      FICTION_SIGNPOSTS.forEach(function(sp) { html += '<div class="tool-item"><div class="tool-title" style="color:#be185d">'+sp.name+'</div><div class="tool-sub">ë°œê²¬: '+sp.trigger+'</div><div class="tool-hint">ì§ˆë¬¸: '+sp.question+'</div></div>'; });
      html += '</div></details>';
      html += '<details style="background:#ecfdf5"><summary>ğŸ“š ë¹„ë¬¸í•™ ì¥ë¥´ë³„</summary><div class="details-content">';
      NONFICTION_GENRES.forEach(function(g) { html += '<div class="tool-item"><div class="tool-title" style="color:#059669">'+g.icon+' '+g.name+'</div><div style="font-size:0.85rem;color:#dc2626;background:#fef2f2;padding:0.5rem;border-radius:8px;margin-top:0.5rem">ğŸ’¡ '+g.insight+'</div></div>'; });
      html += '</div></details>';
      html += '<details style="background:#fef2f2"><summary>ğŸ§  ì „ë¬¸ê°€ 7ê°€ì§€</summary><div class="details-content">';
      EXPERT_STRATEGIES.forEach(function(s) { html += '<div class="tool-item"><div class="tool-title" style="color:#dc2626">'+s.icon+' '+s.name+'</div><div class="tool-sub">'+s.what+'</div><div class="tool-hint">'+s.how+'</div></div>'; });
      html += '</div></details></div>';
      return html;
    }
    function renderEmergency() {
      var html = '<div class="page"><h2 style="text-align:left;font-size:1.3rem">ğŸ†˜ ë§‰í˜”ì„ ë•Œ</h2>';
      EMERGENCY.forEach(function(card) {
        html += '<details style="background:#fffbeb;border:1px solid #fcd34d"><summary style="color:#92400e"><span style="font-size:1.5rem;margin-right:0.5rem">'+card.emoji+'</span>'+card.situation+'</summary><div class="details-content" style="background:#fef3c7">';
        card.strategies.forEach(function(s) { html += '<div class="tool-item"><div style="font-weight:600;margin-bottom:0.5rem">'+s.action+'</div><div style="font-size:0.9rem;color:#475569;margin-bottom:0.5rem">'+s.how+'</div><div style="font-size:0.85rem;color:#059669;background:#ecfdf5;padding:0.5rem 0.75rem;border-radius:8px">ì˜ˆ: '+s.example+'</div></div>'; });
        html += '</div></details>';
      });
      return html + '</div>';
    }
    function renderTimer() {
      var color = state.timer === 0 ? '#ef4444' : state.timerRunning ? '#2563eb' : '#1e293b';
      var html = '<div class="page" style="text-align:center"><h2 style="font-size:1.3rem">â±ï¸ ì§‘ì¤‘ íƒ€ì´ë¨¸</h2><div class="timer-display" style="color:'+color+'">'+formatTime(state.timer)+'</div>';
      if (state.timer === 0) html += '<div style="background:#dcfce7;color:#16a34a;padding:1rem;border-radius:16px;font-weight:600;margin-bottom:1.5rem">ğŸ‰ ì™„ë£Œ! +10ì </div>';
      html += '<div class="timer-presets">';
      [5, 15, 25, 45].forEach(function(m) { html += '<button class="preset-btn '+(state.timerPreset===m?'active':'')+'" onclick="setPreset('+m+')">'+m+'ë¶„</button>'; });
      html += '</div><div class="timer-controls"><button class="timer-main-btn" style="background:'+(state.timerRunning?'#f59e0b':'#2563eb')+'" onclick="toggleTimer()">'+(state.timerRunning?'â¸ ì¼ì‹œì •ì§€':'â–¶ ì‹œì‘')+'</button><button class="timer-reset-btn" onclick="resetTimer()">â†º</button></div></div>';
      return html;
    }
    window.setTab = function(tab) { state.tab = tab; render(); };
    window.selectType = function(type) { state.type = type; state.phase = 0; state.step = 0; state.completed = {}; state.checked = {}; render(); };
    window.resetGuide = function() { state.type = null; state.phase = 0; state.step = 0; state.completed = {}; state.checked = {}; state.view = 'detail'; render(); };
    window.setView = function(v) { state.view = v; render(); };
    window.toggleDetails = function() { state.showDetails = !state.showDetails; render(); };
    window.toggleCheck = function(id) { state.checked[id] = !state.checked[id]; render(); };
    window.goToStep = function(p, s) { state.phase = p; state.step = s; state.view = 'detail'; state.showDetails = true; state.checked = {}; render(); };
    window.completeAndNext = function() { var key = state.phase + '-' + state.step; if (!state.completed[key]) { state.completed[key] = true; state.stats.points += 3; saveStats(); } goNext(); };
    window.goNext = function() { var p = PROTOCOLS[state.type], ph = p.phases[state.phase]; if (state.step < ph.steps.length - 1) state.step++; else if (state.phase < p.phases.length - 1) { state.phase++; state.step = 0; } state.showDetails = true; state.checked = {}; render(); };
    window.goPrev = function() { var p = PROTOCOLS[state.type]; if (state.step > 0) state.step--; else if (state.phase > 0) { state.phase--; state.step = p.phases[state.phase].steps.length - 1; } state.showDetails = true; state.checked = {}; render(); };
    window.setPreset = function(m) { state.timerPreset = m; state.timer = m * 60; state.timerRunning = false; if (timerInterval) clearInterval(timerInterval); render(); };
    window.resetTimer = function() { state.timer = state.timerPreset * 60; state.timerRunning = false; if (timerInterval) clearInterval(timerInterval); render(); };
    window.toggleTimer = function() { state.timerRunning = !state.timerRunning; if (state.timerRunning) { timerInterval = setInterval(function() { if (state.timer > 0) { state.timer--; render(); } else { state.timerRunning = false; clearInterval(timerInterval); state.stats.sessions++; state.stats.points += 10; saveStats(); render(); } }, 1000); } else { if (timerInterval) clearInterval(timerInterval); } render(); };
    render();
  </script>
</body>
</html>
